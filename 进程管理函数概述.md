本文概述操作系统的进程管理函数。

该部分函数（不包括相关系统调用）定义在 lib/env.c 中。

## 函数列表
| 返回类型  | 函数 | 描述 |
|-----------|---|---|
| void | [env_create](进程管理函数概述#void-env_create-u_char-binary-int-size) (u_char \*binary, int size) | 建立一个新进程 |
| void | [env_init](进程管理函数概述#void-env_init-) () | 初始化进程机制 |
| void | [env_run](进程管理函数概述#void-env_run-struct-env-e) (struct Env \*e) | 切换至指定进程 |

## 相关系统调用
| 返回类型  | 函数 | 描述 |
|-----------|---|---|
| void | [env_destroy](进程管理函数概述#void-env_destroy-u_int-envid) (u_int envid) | 销毁指定进程 |
| int | [fork](进程管理函数概述#int-fork-) () | 创建子进程 |
| int | [get_env_id](进程管理函数概述#int-get_env_id-) () | 获取当前进程号 |
| void | [yield](进程管理函数概述#void-yield-) () | 切换至其他进程 |

## 函数信息
#### void env_create (u_char \*binary, int size)
###### 简述
根据 elf 文件，建立一个新进程。新进程将运行二进制可执行程序中的代码。

###### 参数
* `u_char *binary`

  可执行文件的首地址。

* `size_t len`

  可执行文件的长度。

###### 返回值
无

###### 额外信息
该函数调用 env_alloc 函数分配一个空闲进程，然后调用 load_icode 函数加载可执行文件。

* env_alloc 辅助函数

  env_alloc 辅助函数首先从 env_free_list 列表中取得一个空闲进程控制块，然后为其分配一个页目录，设置控制块中相关信息，最后将控制块从空闲列表中删除。

* load_icode 辅助函数

  load_icode 辅助函数为进程分配栈空间，然后调用 load_elf 函数加载二进制文件并设置程序入口点。


#### void env_init ()
###### 简述
初始化进程机制。只有在调用过此函数后，进程机制才能够使用。

###### 参数
无

###### 返回值
无

###### 额外信息
函数简单地初始化所有的进程控制块，并将空闲控制块插入列表中。

#### void env_run (struct Env \*e)
###### 简述
切换至指定的进程。如果当前有用户进程正在运行，其相关信息将会被保存。

###### 参数
* `struct Env *e`

  要切换到的进程。

###### 返回值
无

###### 额外信息
如果当前有用户进程正在运行，函数会将 TIMESTACK 中的内容保存到其进程控制块中。然后函数将需要切换到的进程的控制块中的信息复制到 TIMESTACK 中，切换寻址所用的页目录。函数返回时，TIMESTACK 中的数据将会恢复到相关寄存器中。

## 相关系统调用信息
#### void env_destroy (u_int envid)
###### 简述
销毁指定的进程。

###### 参数
* `u_int envid`

  需要销毁的进程号。

###### 返回值
无

#### int fork ()
###### 简述
根据当前进程创建子进程。创建后的子进程将会拥有与当前进程内容相同的代码段和数据段。两个进程都将继续运行。

###### 参数
无

###### 返回值
如果当前进程是父进程，返回子进程的进程号。
如果当前进程是子进程，返回 0。

#### int get_env_id ()
###### 简述
获取当前进程号。

###### 参数
无

###### 返回值
当前进程号。

#### void yield ()
###### 简述
切换至其他进程。

###### 参数
无

###### 返回值
无
